# TP2:

<!-- [√Ä venir](/cours/BRISE) -->


import CommentCommitPush from '/comment-commit-push.mdx';

# TP2: Julie Pro Plus!

## Consignes (20% de la note finale)
- Lisez toutes les instructions et la grille de correction avant de commencer
- Vous **DEVEZ** faire au moins les migrations et les commits demand√©s mais vous pouvez en faire plus sans probl√®me, tant que vous les documentez correctement


![Image Reference](/tps/tp2/uploadFolder.png)

:::danger

Git n'aime pas les r√©pertoires vide et √† effacera le r√©pertoire wwwroot/images/upload qui est utilis√© pour g√©n√©rer les images d'entra√Æneurs. Il faut recr√©er le r√©pertoire pour que √ßa fonctionne et que les entra√Æneurs soient g√©n√©r√©s correctement.

:::

## Repository de d√©part
- TP2 D√©part - üîó[GitHub](https://github.com/ProgWebTransFC/TP2_DEPART)

## Terminez de mettre en place **i18n**
#### Ce qui est d√©j√† fait :
   - Les packages nuget sont install√©s
   - Les **vues** sont d√©j√† traduites!
   - Les **mod√®les** aussi!
   - Le Inject du **IViewLocalizer** est aussi d√©j√† pr√©sent

#### Ce qu‚Äôil faut faire :
   - Il faut configurer **i18n** dans **Program.cs**. Les fichiers de traduction **resx** se trouvent dans le r√©pertoire ** /i18n/ **
   - Il faut ajouter une fonction **SetLanguage** au **HomeController**
   - Il manque le commutateur de langue dans le **_Layout**. Utilisez une vue partielle et nommez-la **_SelectLanguage**
   - Finalement, il faut g√©rer la culture correctement en ajoutant les librairies n√©cessaires et en modifiant la vue partielle **_ValidationScriptsPartial**. (C'est pas facile de tester cette partie pour l'instant, mais une fois que vous aurez besoin de cr√©er des entr√©es avec des valeurs d√©cimales, assurez-vous que vous pouvez modifier une entre√© avec un nombre avec une d√©cimale en fran√ßais et en anglais sans probl√®me)

<CommentCommitPush/>

## Faites fonctionner le filtre

1. Impl√©mentez la fonction **Filter** du **TrainerController**
2. Impl√©menter la m√©thode **GetAllAsync** du service **TrainerService** pour prendre en compte les param√®tres de pagination de **TrainerSearchViewModelFilter**
3. Dans la m√™me m√©thode, il faut √©galement ajouter des **Where** pour filtrer selon chacun des crit√®res de recherche de **TrainerSearchViewModelFilter**
4. Pour le SelectList de certification centers, il faut obtenir le **CertificationCenter** (une simple string) de toutes les certifications et enlever les doublons, car il est possible que plusieurs certifications aient le m√™me **CertificationCenter**.

:::info

Voici comment faire une requ√™te pour une condition optionnelle dans Linq et ne filtrer que lorsque l'on s√©lectionne une valeur dans le filtre. 

:::

```csharp

.Where(x=> filter.SelectedCategoryId == null || x.CategoryId == filter.SelectedCategoryId ).ToList() 

```

<CommentCommitPush/>

## Affichez le d√©tail d'un **Trainer** dans la page **Trainer/Index**

1. √âcrivez du javascript pour ajouter la classe **show** √† l‚Äô√©l√©ment enfant **aside** lorsqu'on survole le **card** d‚Äôun entra√Æneur.
2. √âcrivez du javascript pour retirer la classe **show** √† l‚Äô√©l√©ment enfant **aside** lorsqu'on ne survole plus le **card**.

:::info

 Comme **aside** est un enfant de **card**, si l'utilisateur bouge sa souris √† l'ext√©rieur de la photo de l'entra√Æneur vers le **aside**, la souris est toujours techniquement au dessus de **card** et √ßa ne cause pas d'√©v√™nement **onmouseout**. **√áa tombe bien, c'est exactement ce que l'on veut!**

:::

![Image Reference](/tps/tp2/showDetails.png)

:::danger

 Cette vue de d√©tail (encadr√©e en rouge) est uniquement en anglais et ce n'est pas un probl√®me pour ce TP. Vous n'avez **PAS** √† la traduire.

:::

<CommentCommitPush/>

## Faire fonctionner la pagination

1. Il faut maintenant utiliser **Items** du mod√®le **TrainerSearchViewModel** qui est un **IPagniatedList&ltTrainer&gt** pour bien afficher les liens de navigations
2. Mettez le code pour que l‚Äôensemble des pages disponibles soient affich√©es dans la pagination.
3. Ajoutez la logique que **Previous** et **Next** fonctionnent et s'affichent lorsque n√©cessaire. 

![Image Reference](/tps/tp2/navigation.png)

4. Ajoutez le javascript (l'utilisation de jQuery est permise, mais pas obligatoire) pour que la page change dans le filtre du formulaire et qu'il se soumette automatiquement lorsqu'on clique sur un √©l√©ment de pagination (incluant Previous et Next). Utilisez les attributs **data-page-id** qui sont d√©j√† l√† sur les √©l√©ments de navigation. Il y a plusieurs fa√ßon d'obtenir le m√™me r√©sultat, mais voici les grandes √©tapes n√©cesaires en JS :
   - Ex√©cuter une fonction JS lorsqu'un √©l√©ment de pagnination est cliqu√©.
   - Obtenir la valeur du **data-page-id** de l'√©l√©ment sur lequel l'utilisateur a cliqu√©.
   - Obtenir l'√©l√©ment qui contient l'information du **SeletectedPageIndex** (libre √† vous d'ajouter un Id pour vous aider √† l'obtenir plus facilement)
   ![Image Reference](/tps/tp2/SelectPageIndex.png)
   - Modifier la valeur de l'√©l√©ment en question
5. Une fois que votre navigation fonctionne bien, mettez le **SelectedPageIndex** (l'√©l√©ment mentionn√© dans le point pr√©c√©dent) en **type="hidden"** et supprimez le libell√© (label associ√©).

<CommentCommitPush/>

## G√©n√©rez les vues et contr√¥leur (RecordController) du mod√®le Record

:::warning

 Au moment de g√©n√©rez le contr√¥leur il faut le nommer **RecordController** et non pas **RecordsController** (Donc, pas de s!).
 C'est important car les liens existants et les fichiers de traduction utilisent tous Record et non pas Records!

:::

:::warning

La g√©n√©ration de contr√¥leur utilisent des [bind] pour les actions post de Create et Edit. √Ä moins que vous soyez d√©j√† famili√© avec leur utilisation, vous pouvez simplement les retirer.

:::

1. G√©n√©rez un contr√¥leur MVC avec ses vues pour le mod√®le Record. (Un lien vers cette vue existe d√©j√† dans la barre de navigation)
2. Lorsqu‚Äôil y a un dropdown, au lieu de le mettre dans le ViewData ou le ViewBag, faites un ViewModel (**RecordViewModel**) (ou plusieurs) avec les SelectList et les informations du mod√®le.

:::warning

Il existe d√©j√† des fichiers .resx pour le view model **RecordViewModel**. Si vous utilisez un autre nom ou utiliez d'autres view models, il faudra s'assurer de faire fonctionner la traduction.

:::

3. Lorsque vous affichez **Trainer**:
   - Affichez le **nom complet** du **Trainer**
4. Lorsque vous affichez **Discipline** 
   - Affichez le **nom** de la **Discipline**
5. Faites un **service** pour utiliser ce/ces ViewModels
6. Utilisez le **service** dans le contr√¥leur 


<CommentCommitPush/>

## Ajoutez une vue pour voir les **Records** d'un **Trainer**
1. Ajoutez une action √† votre contr√¥leur qui permet de voir les **Records** d'un **Trainer** Record/TrainerIndex(int trainerId)
   - Il existe d√©j√† un ic√¥ne de troph√© sur la vue d√©taill√© du Trainer qui doit permettre d'afficher cette page
2. Ajoutez √©galement la vue n√©cessaire

<CommentCommitPush/>

## V√©rification de la traduction

1. Assurez-vous que vos nouvelles pages sont toutes bien traduites 
   - Les resx sont g√©n√©ralement d√©j√† l√†, utilisez-les
   - Il manque la traduction des messages d‚Äôerreur
   - Il faut parfois utiliser un IViewLocalizer pour certaines parties

<CommentCommitPush/>

## Injection du ILogger

1. Injectez le ILogger dans le contr√¥leur Record 
   - Dans les actions Create et Edit
   - Affichez dans la console les logs de type erreur
   - Affichez dans la console les logs de type information sur la cr√©ation et modification de **Records** (nom du **Trainer**, **Discipline** et date de la cr√©ation/modification)

<CommentCommitPush/>

## BONUS
1. Ex√©cuter le filtre lorsqu‚Äôon change n‚Äôimporte quel param√®tre du filtre

:::danger

Une fois que vous avez termin√© votre TP, il est temps de merger votre branche **TP1** dans votre branche **Main**.

:::

## Grille de correction

| T√¢che | Nb Points |
| :--- | :----: |
| Terminer de mettre en place i18n | 8 |
| Faire fonctionner le filtre | 10 |
| Afficher le d√©tail d'un Trainer | 8 |
| Faire fonctionner la pagination | 10 |
| Ajouter RecordController | 12 |
| Ajouter une vue pour les records d'un entra√Æneur | 5 |
| ILogger | 2 |
| Traduire le contenu ajout√© | 5 |
| **Total** | ** /20 ** |
| Point bonus | 1 |

