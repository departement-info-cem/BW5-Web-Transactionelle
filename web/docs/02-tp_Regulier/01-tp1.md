# TP1

import CodeBlock from '@theme/CodeBlock';
import CommentCommitPush from '/comment-commit-push.mdx';

## Consignes (20% de la note finale)

- Lisez toutes les instructions et la grille de correction avant de commencer
- Cr√©ez un Repository `PRIV√â` et ajoutez votre enseignant comme collaborateur
:::danger
N'oubliez pas de choisir l'option **VisualStudio** pour **.gitignore**
:::
- Vous **DEVEZ** faire au moins les migrations et les commits demand√©s, mais vous pouvez en faire plus sans probl√®me, tant que vous les documentez correctement

## √âtude de cas JuliePro

> Julie Loiselle est propri√©taire de l‚Äôentreprise d‚Äôentrainement personnel JuliePro. L‚Äôentreprise emploi une douzaine d‚Äôentra√Æneurs (**Trainer**) chevronn√©s et sp√©cialis√©s (**Speciality** : perte de poids, alth√©rophilie, course, r√©abilitation, etc).
> Un **Trainer** a une seule **Speciality**.
> Chaque client (**Customer**) est assign√© √† un **Trainer**.
> Le **Trainer** d√©finit √©galement avec son client un objectif courant (**Objective**) : soit de perte de poids ou de distance. Lorsqu‚Äôun **Objective** est atteint, on indique la date.

## Les fonctionnalit√©s √† impl√©menter

- Gestion des sp√©cialit√©s (**Speciality**) avec seedüå±
- Gestion des entra√Æneurs (**Trainer**) et de leur sp√©cialit√© (**Speciality**) avec seedüå±
- Ajout √† l'index de sp√©cialit√©s
- Impl√©mentation des r√®gles d'affaire sp√©cifiques
- Utilisation de **vues partielles**
- Utilisation de **FontAwesome**
- Mise en place du mod√®le de donn√©e pour les clients (**Customer**) et de leurs objectifs (**Objective**) avec seedüå±
- Vue de statistiques
- Vue des objectifs des entra√Æneurs

## Cr√©ation du projet

1. Cr√©ez le Repository `PRIV√â` **3W6_TP_NOM_PRENOM** dans GitHub et ajoutez votre enseignant comme collaborateur

2. Cr√©ez un nouveau projet MVC qui se nomme **JuliePro**
3. Dans le projet MVC:

- Il faut t√©l√©charger ce [fichier zip](/tps/tp1/TP1_FichiersComplementaires.zip) qui contient les images utilis√©es dans le projet et extraire son contenu dans le r√©pertoire **/wwwroot/** de votre projet

:::tip

Dites oui pour remplacer les fichiers **bootstrap.css** et **bootstrap.min.css** (Bootstrap **5.1.0** contient un bug, alors on utilise la version **5.1.1**)

:::

- Remplacez le contenu du fichier de Layout par ce qui suit:

import LayoutSource from '!!raw-loader!./../../static/tps/tp1/\_Layout.cshtml';

<details>
<summary>/Views/Shared/_Layout.cshtml</summary>
<p>
<CodeBlock language="html" title="_Layout.cshtml">{LayoutSource}</CodeBlock>
</p>
</details>

- Remplacez le contenu du fichier d'Index par ce qui suit:

import IndexSource from '!!raw-loader!./../../static/tps/tp1/Index.cshtml';

<details>
<summary>/Views/Home/Index.cshtml</summary>
<p>
<CodeBlock language="html" title="Index.cshtml">{IndexSource}</CodeBlock>
</p>
</details>

- Finalement, **ajoutez** ceci **√† la fin** du fichier wwwroot/css/site.css
:::warning
Il faut ajouter √† la fin et non remplacer tout le contenu pour ce fichier
:::

<details>
<summary>/wwwroot/css/site.css</summary>
```
:root {
    --bs-primary: #fc9032;
    --bs-primary-rgb: 232,144,50
}

body {
    background-image: none
}
```
</details>

- Assurez-vous que la page d'accueil de votre application est identique √† celle-ci:

![Image Reference](/tps/tp1/ReferenceProjet.png)

<CommentCommitPush/>

## Gestion des sp√©cialit√©s

1. Ajout de la classe **Speciality** qui sera g√©rer par Entity Framework (**EF**) dans le r√©pertoire **/Models/**

![Image Reference](/tps/tp1/diagrammeSpeciality.png)

```csharp title="Speciality"
public string Name { get; set; }
```

:::info

Il faut ajouter les champs n√©cessaires pour Entity Framework (**EF**) et les annotations. R√©f√©rez-vous au diagramme plus haut qui vous montre les champs de la classe **Speciality**.

:::

2. G√©n√©ration du contr√¥leur MVC pour la classe **Speciality**
3. Ajouter un seedüå± pour les sp√©cialit√©s

```csharp title="Seed des sp√©cialit√©s"
builder.Entity<Speciality>().HasData(new Speciality() { Id = 1, Name = "Perte de poids" });
builder.Entity<Speciality>().HasData(new Speciality() { Id = 2, Name = "Course" });
builder.Entity<Speciality>().HasData(new Speciality() { Id = 3, Name = "Halth√©rophilie" });
builder.Entity<Speciality>().HasData(new Speciality() { Id = 4, Name = "R√©habilitation" });
```

4. Ajoutez une migration et mettez √† jour votre base de donn√©es
5. Le menu **Specialities** de la page principale doit nous diriger vers la gestion des sp√©cialit√©s
6. Prenez un moment pour retirer la vue **Details** et retirer le lien dans la vue **Index**
7. √Ä ce point, vous devez pouvoir faire les actions **CRUD** de **Speciality**

<CommentCommitPush/>

## Gestion des entra√Æneurs

1. Ajout de la classe **Trainer** qui sera g√©rer par Entity Framework Core dans le r√©pertoire **/Models/**

![Image Reference](/tps/tp1/diagrammeTrainer.png)

```csharp title="Trainer"
public string FirstName { get; set; }
public string LastName { get; set; }
public string Email { get; set; }
public string Photo { get; set; }
```

:::info

Il faut ajouter les champs n√©cessaires pour les **relations** et les **annotations**.

:::

2. G√©n√©ration du contr√¥leur MVC pour la classe **Trainer**
3. Ajouter un seedüå± pour les entra√Æneurs

```csharp title="Seed des entra√Æneurs"
builder.Entity<Trainer>().HasData(new Trainer() { Id = 1, FirstName = "Chrystal", LastName = "Lapierre", Email = "Chrystal.lapierre@juliepro.ca", SpecialityId= 1, Photo = "Chrystal.png"});
builder.Entity<Trainer>().HasData(new Trainer() { Id = 2, FirstName = "F√©lix", LastName = "Trudeau", Email = "Felix.trudeau@juliePro.ca", SpecialityId = 2, Photo = "Felix.png" });
builder.Entity<Trainer>().HasData(new Trainer() { Id = 3, FirstName = "Fran√ßois", LastName = "Saint-John", Email = "Frank.StJohn@juliepro.ca", SpecialityId = 1, Photo = "Francois.png" });
builder.Entity<Trainer>().HasData(new Trainer() { Id = 4, FirstName = "Jean-Claude", LastName = "Bastien", Email = "JC.Bastien@juliepro.ca", SpecialityId = 4, Photo = "JeanClaude.png" });
builder.Entity<Trainer>().HasData(new Trainer() { Id = 5, FirstName = "Jin Lee", LastName = "Godette", Email = "JinLee.godette@juliepro.ca", SpecialityId = 3, Photo = "Jin Lee.png" });
builder.Entity<Trainer>().HasData(new Trainer() { Id = 6, FirstName = "Karine", LastName = "Lachance", Email = "Karine.Lachance@juliepro.ca", SpecialityId = 2, Photo = "Karine.png" });
builder.Entity<Trainer>().HasData(new Trainer() { Id = 7, FirstName = "Ramone", LastName = "Esteban", Email = "Ramone.Esteban@juliepro.ca", SpecialityId = 3, Photo = "Ramone.png" });
```

5. Ajoutez une migration et mettez √† jour votre base de donn√©es
6. Le menu **Trainers** de la page principale doit nous diriger vers la gestion des entra√Æneurs

7. Modification de la vue et ajout des entra√Æneurs
   - Dans la vue Index:
     - Triez les entra√Æneurs par FirstName en premier et par LastName ensuite
     - Affichez l'image de la photo de l'entra√Æneur si elle est pr√©sente et limitez sa largeur √† 200 pixels
     - Affichez le nom de la sp√©cialit√©, pas son id
   - Dans la vue Details:
     - Affichez l'image de la photo de l'entra√Æneur en pleine r√©solution si elle est pr√©sente
     - Affichez le nom de la sp√©cialit√©, pas son id
   - Dans la vue Delete:
     - Affichez le nom de la sp√©cialit√©, pas son id
   - Dans les vues Create et Edit:
     - Votre select de sp√©cialit√© est-il vraiment laid?ü§Æ Rappelez-vous que l'on utilise bootstrap et que les diff√©rents √©l√©ments doivent utiliser les classes bootstraps!
     - Permettre de s√©lectionner une sp√©cialit√© et affichez le nom des sp√©cialit√©s et non pas leurs ids
     - Pour la photo, on garde √ßa simple pour l'instant et on doit taper le nom de l'image de l'entra√Æneur

<CommentCommitPush/>

## Ajout √† l'index de sp√©cialit√©s

1. Ajouter une colonne qui affiche les **Trainers** des sp√©cialit√©s
2. Chaque **Trainer** doit √™tre un lien vers la page **Edit** de ce **Trainer**

![alt text](image.png)

<CommentCommitPush/>

## Impl√©mentation de la logique d'affaire

1. Emp√™chez d‚Äôeffacer une **Speciality** si elle est associ√© √† au moins un **Trainer** et affichez un message appropri√© √† l'utilisateur dans ce cas

![Image Reference](/tps/tp1/deleteSpecialityError.png)

2. Assurez-vous que le delete d'une **sp√©cialit√©** fonctionne correctement si elle n'est pas utilis√©e
3. Assurez-vous que le delete d'un **entra√Æneur** fonctionne correctement

<CommentCommitPush/>

## Utilisation des vues partielles et de FontAwesome

1. Utilisez une vue partielle pour regrouper le bouton d'**action** et le bouton de **retour vers la liste**. Utilisez une vue partielle pour les boutons d'actions des vues suivantes:
   - Trainers/Create
   - Trainers/Edit
   - Trainers/Delete
   - Specialities/Create
   - Specialities/Edit
   - Specialities/Delete

:::caution

Chaque action peut avoir sa propre vue partielle et c'est aussi possible que 2 actions partagent une m√™me vue partielle. Au total, vous ne devrez donc pas avoir plus de 3 vue partielles diff√©rentes pour cette section, car il existe 3 actions (Create, Edit et Delete) et vous **DEVEZ** r√©utiliser vos vues partielles entre **Trainer** et **Speciality**

:::

2. Maintenant que vos boutons d'actions sont r√©utilis√©s dans vos diff√©rentes vues, utilisez FontAwesome pour les boutons suivants:
   - <img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plus.svg" width="20" height="20"/> pour Create
   - <img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/floppy-disk.svg" width="20" height="20"/> pour Save
   - <img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/trash.svg" width="20" height="20"/> pour Delete
   - <img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/circle-left.svg" width="20" height="20"/> pour Back to List
3. Si vos boutons sont trop pr√®s des autres champs, donnez leur un peu d'espace!

![Image Reference](/tps/tp1/wrongMargin.png)
‚ùå

![Image Reference](/tps/tp1/rightMargin.png)
üëå

<CommentCommitPush/>

## Ajout de clients et de leurs objectifs

1. Mettez en place le mod√®le de donn√©e pour les clients (**Customer**) et leurs objectifs (**Objective**)

![Image Reference](/tps/tp1/diagrammeCustomer.png)

```csharp title="Customer"
public string FirstName { get; set; }
public string LastName { get; set; }
public string Email { get; set; }
public DateTime BirthDate { get; set; }
public double StartWeight { get; set; }
```

![Image Reference](/tps/tp1/diagrammeObjective.png)

```csharp title="Objective"
public string Name { get; set; }
public double LostWeightKg { get; set; }
public double DistanceKm { get; set; }
public DateTime AchievedDate { get; set; }
```

2. Un **Customer** a donc une relation **un √† plusieurs** avec ses **Objective**. La seule chose qui diff√©rencie l'objectif courant, c'est qu'il n'a pas d'**AchievedDate**.
3. Ajouter un seed üå± avec 3 clients (**Customer**) et leurs objectifs (**Objective**).
   - Les 3 premier clients doivent √™tre associ√© √† l'entra√Æneur: **Chrystal Lapierre**
   - Le 4e client doit √™tre associ√© √† l'entra√Æneur: **F√©lix Trudeau**
   - Un objectif est consid√©r√© comme **courant** si il n'a pas d'AchievedDate et comme **compl√©t√©** si il en a un.
   - Le premier client doit avoir un objectif **courant** et **trois** objectifs **compl√©t√©**.
   - Le deuxi√®me client doit avoir **deux** objectifs **courants**.
   - Le troisi√®me client doit avoir **deux** objectifs **compl√©t√©s**.
   - Le quatri√®me client doit avoir un objectif **courant** et un objectif **compl√©t√©**.
   - Le contenu exacte des objectif n'est pas important, mais ils doivent tous √™tre diff√©rents et ils doivent contenir un m√©lange de courses et de perte de poids.
4. Une fois que c'est fait, v√©rifiez les donn√©es dans votre base de donn√©es!

<CommentCommitPush/>

## Ajout d'une page de statistiques

1. Cr√©er une page pour afficher des statistiques √† propos de l'application.
2. Il faut ajouter **Stats** dans le menu de navigation pour pouvoir acc√©der √† la page de statistiques.
3. Il faut utiliser un **ViewModel** pour contenir les informations √† afficher dans cette vue, nommez-le simplement **StatsVM**.
4. Il faut utiliser **Linq** pour obtenir les stats. Chaque stat va demander l'utilisation d'au moins une m√©thode de Linq qui est sp√©cifi√©e dans les instructions.
5. Voici les stats qu'il faut afficher
- La distance totale des objectifs avec une Distance (En utilisant **Sum** de Linq)
- Le nombre d'objectifs le plus √©lev√© d'un m√™me client (En utilisant **Max** de Linq)
- Une tr√®s courte liste avec les deux clients les plus vieux en ordre d√©croissant. Il faut afficher leurs noms et leurs √¢ges. (En utilisant **OrderBy** et **Take** de Linq)
- Les deux stats suivantes sont seulement pour l'entra√Æneur Chrystal Lapierre
  - La perte de poids moyenne de ses clients (Moyenne par client, pas par objectif en utilisant **Average** et **Sum** de Linq) 
  - Le nombre maximal d'objectifs compl√©t√©s par un de ses clients (En utilisant **Max** de Linq)
6. Voici une r√©f√©rence pour comprendre ce que l'application doit afficher. (Les valeurs ne sont **pas** les bonnes, √©videmment)

<details>
![alt text](image-1.png)
</details>

:::info
Vous pouvez faire cette page en fran√ßais ou en anglais.
:::

<CommentCommitPush/>

## Affichage d'un menu d'objectifs

1. C'est maintenant le moment de travailler sur la derni√®re fonctionnalit√©e, l'affichage des objectifs.
2. Il faut ajouter une nouvelle option qui doit se nommer **Objectives** dans le menu de navigation pour pouvoir acc√©der √† la page d'objectifs.
3. Voici ce que l'on doit voir dans ce menu lorsque l'on clique sur **Chrystal Lapierre**:
![Image Reference](/tps/tp1/Objectives.png)

4. Et lorsque l'on clique sur **F√©lix Trudeau**:
![Objectifs #2](/tps/tp1/Objectives2.png)

5. Pour le menu pr√©c√©dent vous devrez utiliser un **accordion** de bootstrap pour afficher chacun des entra√Æneurs.
6. Une fois que vous affichez le contenu pour un entra√Æneur, utilisez simplement un tableau.
7. Pour ce menu, vous **devez** utiliser au une vue partielle pour affichez le tableau et vous **devez** √©galement utiliser une vue partielle pour afficher le contenu de chaque rang√© du tableau.
8. Vous **devez** √©galement utiliser un ViewModel qui doit se nommer **TrainerObjectivesVM**.
9. Vous **devez** √©galement cr√©er un ViewModel qui doit se nommer **CustomerObjectivesVM**.
10. Le ViewModel **TrainerObjectivesVM** **doit**, en plus de ses autres propri√©t√©s, contenir un IEnumerable\<CustomerObjectivesVM\>.

11. Vous pouvez nommer vos vues comme vous le voulez, mais voici une suggestion:
   - Vue principale avec l'accord√©on (**accordion**) (AllObjectives.cshtml)
     - Vue partielle avec le tableau (TrainerObjectives.cshtml)
       - Vue partielle avec une rang√© du tableau (CustomerObjectives.cshtml)
12. Remarquez que pour chaque titre de l'**accordion** on affiche le nom de l'entra√Æneur **ET sa sp√©cialit√©**.
13. Pour le status, il faut afficher un de ces 3 messages qui d√©pend directement du nombre d'objectif incomplet qui est affich√© dans la colonne pr√©c√©dente. Utilisez une couleur diff√©rente pour chaque message (color-success, color-warning, color-danger).


<CommentCommitPush/>

## Grille de correction

| T√¢che                                           | Nb Points |
| :---------------------------------------------- | :-------: |
| Mise en place du projet initial                 |     1     |
| Gestion des sp√©cialit√©s                         |     2     |
| Gestion des entra√Æneurs                         |     3     |
| Ajout √† l'index de sp√©cialit√©s                  |     2     |
| Logique d'affaire                               |     1     |
| Utilisation de vues partielles pour les boutons |     1     |
| Utilisation de FontAwesome                      |     1     |
| Ajout des clients et de leurs objectifs         |     1     |
| Affichage de statisques avec requ√™tes Linq      |     3     |
| Affichage des objectifs                         |     4     |
| Consignes Git (commits/push)                    |     1     |
| **Total**                                       |  **/20**  |
